var LinkStack=function(){"use strict";var a=document.querySelector("#url"),b=document.querySelector("#title"),c=document.querySelector("#tags"),d=document.querySelector("#push-it"),e=(document.querySelector("#push-form"),null),f=null,g=document.querySelector("#recentlist tbody"),h="https://eternal-dynamo-704.appspot.com",i="./api",j=!1,k=function(){if(!(a.value.length<5||j)&&(b.value.length<1||c.value.length<1)){j=!0;var d=h+"/info?url="+a.value,e=new XMLHttpRequest;e.open("GET",d,!0),e.onreadystatechange=function(){return 4!==e.readyState||200!==e.status?void(j=!1):void l(e.responseText)},e.send()}},l=function(d){j=!1;var e=JSON.parse(d);"None"!=e.title&&b.value.length<1&&(b.value=e.title),"None"!=e.meta&&c.value.length<1&&(c.value=e.meta),a.value!=e.longurl&&(a.value=e.longurl)},m=function(g){if(g.preventDefault(),!(a.value.length<5)){var h=new t(a.value,b.value,c.value),j=new XMLHttpRequest;j.open("POST",i+"/items?key="+e+"&timestamp="+f,!0),d.innerHTML="Pushing...",d.disabled=!0,j.onreadystatechange=function(){4===j.readyState&&201===j.status&&n(j)};var k=JSON.stringify(h);j.send(k)}},n=function(e){var f=JSON.parse(e.responseText);p(a.value,b.value,c.value,f.itemId),d.innerHTML="Push It!",d.disabled=!1,o()},o=function(){a.value="",b.value="",c.value=""},p=function(a,b,c,d){var e=new Date,f=e.getFullYear(),h=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,i=e.getDate()<10?"0"+e.getDate():e.getDate(),j=e.getHours()<10?"0"+e.getHours():e.getHours(),k=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),l=f+"-"+h+"-"+i+" "+j+":"+k,m=c.length>25?'title="'+c.substr(0,25)+'"':"",n=c.length>25?c.substr(0,25)+"...":c,o=b.length>50?'title="'+b.substr(0,50)+'"':"",p=b.length>50?b.substr(0,50)+"...":b,r=document.createElement("tr");r.innerHTML='<td><img src="https://www.google.com/s2/favicons?domain='+a+'" alt="fav"> <a class="title" href="'+a+'">'+a+"</a></td><td "+o+">"+p+"</td><td "+m+">"+n+"</td><td>"+l+'</td><td class="action"><button type="button" class="btn btn-default btn-sm delete-btn icon-button" data-id="'+d+'"><svg><use xlink:href="#icon-trash-o" /></svg></button></td>',g.insertBefore(r,g.firstChild);var s=document.querySelector('button[data-id="'+d+'"]');s.onclick=q},q=function(){console.log(this);var a=this,b=this.getAttribute("data-id"),c=new XMLHttpRequest;c.open("DELETE",i+"/items/"+b+"?key="+e+"&timestamp="+f,!0),c.onreadystatechange=function(){4===c.readyState&&200===c.status&&(console.log("done"+c.status),r(a,c))},a.className+=" spinner",c.send()},r=function(a,b){console.log("muu"+b.status);var c=a.parentNode.parentNode;console.log(c),200==b.status&&c.remove()},s=function(b,c){e=b,f=c,console.log("set hooks"),null!==a&&(a.onkeyup=k,a.onmouseout=k,a.onchange=k,d.onclick=m);var g=document.querySelectorAll(".delete-btn");Array.prototype.forEach.call(g,function(a){a.onclick=q}),console.log("loaded")},t=function(a,b,c){var d={};return d.url=a,d.title=b,d.tags=c,d};return{setUp:s}}();