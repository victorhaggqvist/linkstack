"use strict";!function(){var e=this,t=document.querySelector("#form_url"),n=document.querySelector("#form_title"),o=document.querySelector("#form_tags"),l=document.querySelector("#form_save"),u=document.querySelector("#recentlist tbody"),r=document.querySelector("#status"),s=document.querySelector("#statusMsg"),a="https://tool.stack.snilius.com",i=!1,c=function(){if(!i&&!(t.value.length<5)&&(n.value.length<1||o.value.length<1)){i=!0;var e=a+"/info?url="+t.value;fetch(e).then(function(e){return e.json()},function(e){i=!1,console.error("meta fetch fail: "+e)}).then(function(e){void 0!==e&&(i=!1,n.value.length<1&&(n.value=e.title),o.value.length<1&&(o.value=e.meta),t.value!==e.longurl&&(t.value=e.longurl))})}},d=function(){console.log(e);var t=e,n=e.getAttribute("data-id");t.className+=" spinner",fetch("/api/items/"+n,{method:"delete",credentials:"include"}).then(function(e){204===e.status&&t.parentNode.parentNode.remove(),console.log(e)},function(e){return console.error(e)})},g=function(e,t,n,o){var l=new Date,r=l.getFullYear(),s=l.getMonth()+1<10?"0"+(l.getMonth()+1):l.getMonth()+1,a=l.getDate()<10?"0"+l.getDate():l.getDate(),i=l.getHours()<10?"0"+l.getHours():l.getHours(),c=l.getMinutes()<10?"0"+l.getMinutes():l.getMinutes(),g=r+"-"+s+"-"+a+" "+i+":"+c,h=n.length>25?'title="'+n.substr(0,25)+'"':"",f=n.length>25?n.substr(0,25)+"...":n,m=t.length>50?'title="'+t.substr(0,50)+'"':"",v=t.length>50?t.substr(0,50)+"...":t,b=document.createElement("tr");b.innerHTML='<td><img src="https://www.google.com/s2/favicons?domain='+e+'" alt="fav"><a class="title" href="'+e+'">'+e+"</a></td><td"+m+">"+v+"</td><td"+h+">"+f+"</td><td>"+g+'</td><td class="action"><button type="button" class="btn btn-default btn-sm delete-btn icon-button" data-id="'+o+'"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button></td>',u.insertBefore(b,u.firstChild);var y=document.querySelector('button[data-id="'+o+'"]');y.onclick=d};l.onclick=function(e){e.preventDefault();var u={title:n.value,url:t.value,tags:o.value};l.innerHTML="Pushing...",l.disabled="disabled",fetch("/api/items",{method:"post",body:JSON.stringify(u),credentials:"include"}).then(function(e){return e.json()}).then(function(e){"message"in e?(s.innerHTML=e.message,r.style.display="block",l.disabled=null,l.innerHTML="Push"):(console.log(e),g(u.url,u.title,u.tags,e.id),t.value="",n.value="",o.value="",l.disabled=null,l.innerHTML="Push")},function(e){return console.error(e)})},console.info("set hooks"),t.onkeyup=c,t.onmouseout=c,t.onchange=c;var h=document.querySelectorAll(".delete-btn");Array.prototype.forEach.call(h,function(e){e.onclick=d}),console.info("linkstack boot")}();